(this["webpackJsonpcreate-react-app2"]=this["webpackJsonpcreate-react-app2"]||[]).push([[0],{194:function(e,t,n){e.exports=n(378)},216:function(e,t,n){},218:function(e,t,n){},367:function(e,t,n){},369:function(e,t,n){},370:function(e,t,n){},371:function(e,t,n){},377:function(e,t,n){},378:function(e,t,n){"use strict";n.r(t);var a,r=n(0),i=n.n(r),c=n(16),o=n(28),s=n(10),l=n(11),u=n(42),d=n(50),h=n.n(d),p=(n(205),n(179)),f=n(181),m=n(180),E=(n(53),{OFFINE:!1,API_LOGIN_URL:(a=void 0===window.siteurl?"http://treasureisland.local":window.siteurl)+"/wp-json/jwt-auth/v1/token",API_POST_URL:a+"/wp-json/wp/v2/"+"posts",API_AUDIO_URL:a+"/wp-json/audio/",API_MENU_URL:a+"/wp-json/menu/",API_DICTIONARY_URL:a+"/wp-json/dictionary/",isAdmin:!1});fetch("".concat(E.API_LOGIN_URL,"?username=demo&password=demo"),{method:"POST"}).then((function(e){return e.json()})).then((function(e){return E.token=e.token})).catch((function(e){return alert("Login error")}));var y=E,v=function(e){return{type:"RECEIVE_POST",post:e}},g=n(6),I=n.n(g),b=function(e){return e.items},S=Object(l.c)({items:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REQUEST_POST":return e;case"RECEIVE_POST":return I.a.unionBy(I.a.isArray(t.post)?t.post:[t.post],e,"id");default:return e}}}),O=function(e){return{type:"RECEIVE_POST",post:e}},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){return t({type:"REQUEST_POST"}),fetch(y.API_POST_URL+"/"+(e.postId||""),{headers:{Authorization:"Bearer "+y.token}}).then((function(e){return e.json()})).then((function(e){return t(O(e))})).catch((function(e){return t(O([]))}))}},T=function(e){return{type:"RECEIVE_REFERENCES",references:e}},_=function(e){return e.items},A=function(e){return e.references},j=function(e){return e.status>0},R=Object(l.c)({items:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REQUEST_POST":return e;case"RECEIVE_POST":return I.a.unionBy(I.a.isArray(t.post)?t.post:[t.post],e,"id");default:return e}},references:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REQUEST_REFERENCES":return e;case"RECEIVE_REFERENCES":return console.log(t.references),Object.assign(t.references,e);default:return e}},status:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_REFERENCES":case"RECEIVE_POST":return e-1;case"REQUEST_REFERENCES":case"REQUEST_POST":return e+1;default:return e}}}),w=function(e){return{type:"RECEIVE_AUDIO",list:e}},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){t({type:"REQUEST_AUDIO"}),fetch(y.API_AUDIO_URL+"list?post_parent="+e.postId+"showAlsoUnassigned",{headers:{Authorization:"Bearer "+y.token}}).then((function(e){return e.json()})).then((function(e){return t(w(e))})).catch((function(e){return t(w([]))}))}},N=function(e){return{type:"SETTED_AUDIO",reference:e.reference}},U=function(e){return e.items},x=function(e){return e.reference},P=function(e){return e.isSetting},D=Object(l.c)({items:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"AUDIO_RESET":return[];case"REQUEST_AUDIO":return e;case"RECEIVE_AUDIO":return I.a.unionBy(t.list,e,"id");default:return e}},reference:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_AUDIO":return e;case"SETTED_AUDIO":return t.reference;default:return e}},isSetting:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_AUDIO":return e+1;case"SETTED_AUDIO":return e-1;default:return e}}}),L=function(e){return{type:"RECEIVE_CATEGORY",posts:e}},F=Object(l.c)({posts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_CATEGORY":return t.posts;case"REQUEST_CATEGORY":default:return e}}}),M=function(e){return{type:"RECEIVE_MEANING",meaning:e}},B=function(e){return{type:"RECEIVE_TRADUCTION",traduction:e}},V=function(e){return e.meaning},K=function(e){return e.traduction},Q=function(e){return e.isFetchingMeaning},z=function(e){return e.isFetchingTraduction},H=Object(l.c)({meaning:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_MEANING":return t.meaning;case"REQUEST_MEANING":default:return e}},traduction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_TRADUCTION":return t.traduction;case"REQUEST_TRADUCTION":default:return e}},isFetchingMeaning:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REQUEST_MEANING":return e+1;case"RECEIVE_MEANING":return e-1;default:return e}},isFetchingTraduction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REQUEST_TRADUCTION":return e+1;case"RECEIVE_TRADUCTION":return e-1;default:return e}}}),G={key:"root",storage:h.a,blacklist:["posts","audio","reader","category","dictionary"],debug:!0},W=Object(u.a)(G,{posts:Object(u.b)({key:"posts",storage:h.a,blacklist:y.OFFLINE?["isFetching","hasMore"]:["isFetching","hasMore","items"]},S),reader:Object(u.b)({key:"reader",storage:h.a,blacklist:y.OFFLINE?["isFetching","hasMore"]:["isFetching","hasMore","items"]},R),audio:Object(u.b)({key:"audio",storage:h.a,blacklist:y.OFFLINE?["isFetching","hasMore"]:["isSetting"]},D),category:Object(u.b)({key:"category",storage:h.a,blacklist:y.OFFLINE?["isFetching","hasMore"]:["isSetting"]},F),dictionary:Object(u.b)({key:"dictionary",storage:h.a,blacklist:y.OFFLINE?["isFetching","hasMore"]:["isSetting"]},H)}),Y=Object(f.a)(),X=Object(l.d)(W,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__(),void 0,Object(l.a)(p.a,Object(m.routerMiddleware)(Y)));Object(u.c)(X);var q=X,J=n(12),$=n(13),Z=n(17),ee=n(15),te=n(14),ne=(n(216),n(217),n(392)),ae=n(393),re=n(390),ie=n(394),ce=n(395),oe=n(396),se=n(21),le=n.n(se),ue=n(379),de=n(382),he=n(385),pe=n(61),fe=n(388),me=n(391),Ee=(n(218),function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){var a;return Object(J.a)(this,n),(a=t.call(this,e)).state={parentWidth:2e3,expanded:!1,activeKey:null},a.handleExpandSide=a.handleExpandSide.bind(Object(Z.a)(a)),a.handleSelect=a.handleSelect.bind(Object(Z.a)(a)),a}return Object($.a)(n,[{key:"componentDidMount",value:function(){this.setState({parentWidth:le.a.findDOMNode(this).parentNode.clientWidth});var e=this,t=function(e,t){var n,a=arguments,r=this;return function(i){clearTimeout(n),n=setTimeout((function(t){n=null,e.apply(r,a)}),t)}}((function(){e.setState({parentWidth:le.a.findDOMNode(e).parentNode.clientWidth})}),300);window.addEventListener("resize",t);var n=this.props.dispatch;!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){return t({type:"REQUEST_CATEGORY"}),fetch(y.API_MENU_URL+"category?category_slug="+e.categorySlug).then((function(e){return e.json()})).then((function(e){return t(L(e))})).catch((function(e){return L([])}))}}({categorySlug:"treasure-island"})(n)}},{key:"handleExpandSide",value:function(){this.setState({expanded:!this.state.expanded})}},{key:"handleSelect",value:function(e){this.setState({activeKey:String(e)})}},{key:"render",value:function(){var e=this.props.posts,t=this.state.expanded;return this.state.parentWidth<window.viewPorts.sm?i.a.createElement(ue.a,{appearance:"inverse",expanded:t,className:t?"":"sidenav-compact",defaultOpenKeys:[],activeKey:this.state.activeKey,onSelect:this.handleSelect},i.a.createElement(ue.a.Body,null,i.a.createElement(de.a.Body,null,i.a.createElement(he.a,{onSelect:this.props.onSelect,activeKey:this.props.activeKey},i.a.createElement(he.a.Item,{onClick:this.handleExpandSide,eventKey:"1",style:{height:56},icon:i.a.createElement(pe.a,{icon:"bars",size:"lg"}),componentClass:"span"},i.a.createElement(o.b,{to:"/"})),i.a.createElement(fe.a,{title:"Altro",eventKey:"a"},i.a.createElement(fe.a.Item,{eventKey:"4"},i.a.createElement("a",{href:"/company/"},"Company")),i.a.createElement(fe.a.Item,{eventKey:"5"},i.a.createElement(o.b,{to:"/"},"Team")),i.a.createElement(fe.a.Item,{eventKey:"6"},i.a.createElement(o.b,{to:"/"},"Contact"))),i.a.createElement(me.a,null))))):i.a.createElement(de.a,Object.assign({},this.props,{className:"main-nav"}),i.a.createElement(de.a.Header,null,i.a.createElement("a",{href:"/",className:"navbar-brand logo"},i.a.createElement(pe.a,{icon:"anchor"}))),i.a.createElement(de.a.Body,null,i.a.createElement(he.a,{onSelect:this.props.onSelect,activeKey:this.props.activeKey},i.a.createElement(he.a.Item,{eventKey:"1",componentClass:"span",icon:i.a.createElement(pe.a,{icon:"home"})},i.a.createElement(o.b,{to:"/"},"Home")),ye("Treasure Island",e,y.isAdmin))))}}]),n}(i.a.Component));var ye=function(e,t,n){if(I.a.isEmpty(t))return null;var a=[],r=[];I.a.forEach(t,(function(e,c){if(I.a.find(e.tags,(function(e){return"eng"===e.name}))){var s=I.a.find(e.tags,(function(e){return"chapter"===e.name.split("-")[0]})),l=e,u=function(e,t,n){var a=null;return I.a.forEach(e,(function(e){I.a.find(e.tags,(function(e){return e.name===n}))&&I.a.find(e.tags,(function(e){return e.name===t}))&&(a=e)})),a}(t,s.name,"ita"),d=e.sub_category.name;void 0===a[d]&&(a[d]=[],r[d]=[]),a[d].push(i.a.createElement(fe.a.Item,{key:c},i.a.createElement("div",{style:{display:"flex"}},i.a.createElement(o.b,{to:"/reader/"+l.ID+"/"+u.ID},l.post_title.split(" ")[1]," - ",l.chapter),n?i.a.createElement(o.b,{to:"/editor/"+l.ID},"EDIT"):null,i.a.createElement(me.a,null)))),r[d]=e.sub_category.description}}));var c=[];for(var s in a)c.push(i.a.createElement(fe.a.Menu,{key:s,title:s+" - "+r[s]},I.a.reverse(a[s]))),c.push(i.a.createElement(fe.a.Item,{divider:!0}));return I.a.reverse(c),i.a.createElement(fe.a,{title:e},c)},ve=Object(c.connect)((function(e){return{posts:e.category.posts}}),(function(e){return Object.assign({dispatch:e})}))(Ee);window.viewPorts={xs:0,sm:480,md:960,lg:1200};var ge=function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){var a;return Object(J.a)(this,n),(a=t.call(this,e)).handleSelect=a.handleSelect.bind(Object(Z.a)(a)),a.state={activeKey:null,loading:!1},a}return Object($.a)(n,[{key:"handleSelect",value:function(e){this.setState({activeKey:e})}},{key:"render",value:function(){var e=this,t=this.state.activeKey;return void 0===y.token?(I.a.delay((function(t){return e.setState(t)}),1e3,{loading:!this.state.loading}),i.a.createElement("div",null,"Loading... ",this.state.loading)):i.a.createElement(ne.a,{className:"App"},i.a.createElement("div",{className:"view-port"},i.a.createElement(ae.a,{className:"header-container"},i.a.createElement(ve,{appearance:"inverse",onSelect:this.handleSelect,activeKey:t})),i.a.createElement(re.a,{justify:"center"},i.a.createElement(re.a.Item,{componentClass:ie.a,xs:24,sm:24,lg:20,xl:15,className:"main-container"},i.a.createElement(ce.a,null,this.props.children)))),i.a.createElement(oe.a,{className:"footer-container"},"Treasure Island by Robert Louis Stevenson"))}}]),n}(i.a.Component);ge.defaultProps={children:null};var Ie=Object(s.f)(Object(c.connect)((function(e){return{}}),{})(ge));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var be=n(397),Se=n(387),Oe=(n(367),function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){var a;return Object(J.a)(this,n),(a=t.call(this,e)).state={posts:null},a}return Object($.a)(n,[{key:"render",value:function(){var e=this.props.posts;return i.a.createElement(re.a,null,i.a.createElement(re.a.Item,{componentClass:ie.a,lg:4,xl:5}),i.a.createElement(re.a.Item,{componentClass:ie.a,lg:16,xl:14},i.a.createElement(be.a,null,i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement("h1",null,"Treasure Island"),i.a.createElement("h3",null,"Martin Louis Stevenson"),i.a.createElement("figure",null,i.a.createElement("img",{style:{height:"500px",borderRadius:"5px"},src:"https://images.unsplash.com/photo-1564845654222-d437f029c5c4?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1351&q=80",alt:"Alfonso Reyes - boat"}),i.a.createElement("figcaption",null,"Image from unsplash by Alonso Reyes")),i.a.createElement("hr",null),i.a.createElement("p",null,"Audio-libro bilingue Inglese-Italiano con supporto dizionario (Oxford)"),i.a.createElement("p",null,"Letto da: Mark F. Smith, audio completo su ",i.a.createElement("a",{href:"https://www.youtube.com/watch?v=PuiDkBO_SAY"},"Youtube")),i.a.createElement("p",null,"Traduzione da: ",i.a.createElement("a",{href:"https://libri.freenfo.net/3/3044030.html"},"libri.freenfo.net")),i.a.createElement("p",null,"Dev by: Alessio Guerriero")),i.a.createElement("hr",null),i.a.createElement("h3",null,"Utilizzo"),i.a.createElement("div",{dangerouslySetInnerHTML:{__html:'<iframe width="100%" height="600px" src="https://www.youtube.com/embed/UwHFogMirgU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'}}),i.a.createElement("hr",null),i.a.createElement("h3",null,"Contents"),Te("Treasure Island",e,y.isAdmin))))}}]),n}(i.a.Component)),ke=Object(c.connect)((function(e){return{posts:e.category.posts}}),null)(Oe),Te=function(e,t,n){if(I.a.isEmpty(t))return null;var a=[],r=[];I.a.forEach(t,(function(e,c){if(I.a.find(e.tags,(function(e){return"eng"===e.name}))){var s=I.a.find(e.tags,(function(e){return"chapter"===e.name.split("-")[0]})),l=e,u=function(e,t,n){var a=null;return I.a.forEach(e,(function(e){I.a.find(e.tags,(function(e){return e.name===n}))&&I.a.find(e.tags,(function(e){return e.name===t}))&&(a=e)})),a}(t,s.name,"ita"),d=e.sub_category.name;void 0===a[d]&&(a[d]=[],r[d]=[]),a[d].push(i.a.createElement(Se.a.Item,{key:c},i.a.createElement("div",{style:{display:"flex"}},i.a.createElement(o.b,{to:"/reader/"+l.ID+"/"+u.ID},l.post_title," - ",l.chapter),n?i.a.createElement(o.b,{to:"/editor/"+l.ID},"EDIT"):null))),r[d]=e.sub_category.description}}));var c=[];for(var s in a)c.push(i.a.createElement(be.a,{header:s+" - "+r[s]},i.a.createElement(Se.a,{key:s},I.a.reverse(a[s]))));return i.a.createElement("div",{id:"contents"},I.a.reverse(c))};var _e=n(389),Ae=n(71),je=n(398),Re=(n(369),function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){var a;return Object(J.a)(this,n),(a=t.call(this,e)).list=[],a.currentPlay="",a.currentPlayIndex=a.firstIndex=0,a.lastActionTime=Date.now(),a.prevAction="",a.reference="",a.selectAudio=a.selectAudio.bind(Object(Z.a)(a)),a}return Object($.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.dispatch,n=e.postId;C({postId:n})(t)}},{key:"componentDidUpdate",value:function(e,t){I.a.isEmpty(this.list)||I.a.isEmpty(this.currentPlay)&&(this.currentPlayIndex=this.firstIndex=Number(Object.keys(this.list)[0]),this.currentPlay=this.getAudioId(this.currentPlayIndex));var n=this.props,a=n.reference;n.isSettingReference||""!==this.reference&&(a===this.reference?console.log("Update reference ok "+a):console.log("error update reference: "+this.reference+" - "+a),this.reference="")}},{key:"getAudioId",value:function(e){return"audio-"+this.list[e].id}},{key:"isPlaying",value:function(e){return"audio-"+e===this.currentPlay}},{key:"isPlaylistEnded",value:function(){return this.list.length===this.currentPlayIndex+1}},{key:"play",value:function(){I.a.isEmpty(this.currentPlay)?alert("Playlist vuota!"):document.getElementById(this.currentPlay).play()}},{key:"getIdFromFilename",value:function(e){return Number(e.split("-")[1].split(".")[0])}},{key:"nextTrack",value:function(){this.isPlaylistEnded()?alert("Playlist ended!"):(this.previousPlay=this.currentPlay,this.currentPlay=this.getAudioId(++this.currentPlayIndex))}},{key:"prevTrack",value:function(){this.currentPlayIndex!==this.firstIndex&&(this.currentPlay=this.getAudioId(--this.currentPlayIndex))}},{key:"selectAudio",value:function(e){var t=this.getIdFromFilename(e.name);this.currentPlayIndex=t,this.currentPlay=this.getAudioId(t),this.setState({refresh:""}),this.props.handleSelect(e.reference)}},{key:"render",value:function(){var e=this,t=this.props,n=t.audioList,a=t.postId,r=t.selected,c=t.dispatch,o=t.isSettingReference,s=this.props.action,l=null;if(!I.a.isEmpty(n)){if(Date.now()-this.lastActionTime>200&&this.prevAction!==this.props.action)switch(console.log("action: "+this.props.action+" ---- pre:"+this.prevAction),this.prevAction=this.props.action,this.lastActionTime=Date.now(),this.props.action){case"play":this.play();break;case"prev":this.prevTrack();break;case"next":this.nextTrack();break;case"refresh-audio-list":_e.a.info({title:"refresh audio list"});var u=this.props,d=u.dispatch,h=u.postId;u.showAlsoUnassigned;d({type:"AUDIO_RESET"}),C({postId:h})(d)}var p=I.a.filter(n,(function(e){return e.post_parent==a||0==e.post_parent})),f=0;I.a.forEach(p,(function(t){var n=e.getIdFromFilename(t.name);e.isPlaying(t.id)&&(f=n),"insert"===s&&e.isPlaying(t.id)?(e.reference="".concat(a,"-").concat(r),t=I.a.assign(t,{reference:e.reference}),e.list[n]=t,o||(!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){t({type:"SET_AUDIO"});var n=new FormData;n.append("post_id",e.id),n.append("reference",e.reference),n.append("post_parent",e.post_parent),fetch(y.API_AUDIO_URL+"set",{method:"POST",headers:{Authorization:"Bearer "+y.token},body:n}).then((function(e){return e.json()})).then((function(e){return t(N(e))})).catch((function(e){return t(N({}))}))}}({id:t.id,reference:e.reference,post_parent:a})(c),s="")):I.a.isUndefined(e.list[n])&&(e.list[n]=t)})),l=this.list.map((function(t){var n=e.getIdFromFilename(t.name);return i.a.createElement(we,{item:t,hide:n<f-5,active:e.isPlaying(t.id),handleClick:e.selectAudio})}))}return i.a.createElement(be.a,{className:"right-panel"},l||null)}}]),n}(i.a.Component)),we=function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(){return Object(J.a)(this,n),t.apply(this,arguments)}return Object($.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.item,a=t.active,r=t.hide;return i.a.createElement("div",{key:n.id,id:n.id,className:"audio-container "+(a?"selected ":"")+(r?"hidden":""),onClick:function(){e.props.handleClick(n)}},n.name.split(".")[0],I.a.isEmpty(n.reference)?"":" - "+n.reference,i.a.createElement("audio",{controls:!0,id:"audio-"+n.id},i.a.createElement("source",{src:n.source,type:"audio/mpeg"})))}}]),n}(i.a.Component),Ce=Object(c.connect)((function(e){return{audioList:U(e.audio),reference:x(e.audio),isSettingReference:P(e.audio)}}),(function(e){return Object.assign({},{dispatch:e})}))(Re),Ne=(n(370),function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){return Object(J.a)(this,n),t.call(this,e)}return Object($.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.selected,a=t.data,r=t.counter,c=0;return I.a.map(a.split(" "),(function(t){c++;var a=r+"-"+c,o="piece";return a===n&&(o="piece selected"),i.a.createElement("span",{id:a,onClick:e.props.handleSelect,className:o,dangerouslySetInnerHTML:{__html:"&nbsp;"+t}})}))}}]),n}(i.a.Component)),Ue=function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){var a;return Object(J.a)(this,n),(a=t.call(this,e)).postId=a.props.match.params.post,a.state={selected:0,audioSelected:0,action:"",canAttach:!1,allAudio:!1,actionList:[]},a.oldSelected=a.state.selected,a.handleSelect=a.handleSelect.bind(Object(Z.a)(a)),a.handleSelectAudio=a.handleSelectAudio.bind(Object(Z.a)(a)),a}return Object($.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){return t({type:"REQUEST_POST"}),fetch(y.API_POST_URL+"/"+(e.postId||""),{headers:{Authorization:"Bearer "+y.token}}).then((function(e){return e.json()})).then((function(e){return t(v(e))})).catch((function(e){return t(v([]))}))}}({postId:this.postId})(e)}},{key:"refresh",value:function(){this.componentDidMount(),this.trigger("refresh-audio-list"),this.setState({})}},{key:"componentDidUpdate",value:function(e,t){if(this.oldSelected=this.state.selected,!I.a.isEmpty(this.state.actionList)){var n=this.state.actionList;if(this.state.action!==n[n.length-1]){var a=n.pop();I.a.delay(this.setState.bind(this),100,{action:a})}}}},{key:"handleSelect",value:function(e){this.setState({selected:e.currentTarget.id})}},{key:"handleSelectAudio",value:function(e){var t=e.split("-");e="".concat(t[1],"-").concat(t[2]),this.oldSelected=e,this.setState({selected:e,action:""})}},{key:"selectionChanged",value:function(){return this.oldSelected!==this.state.selected}},{key:"insertNextNplay",value:function(){if(!1===this.state.canAttach)return _e.a.info({title:"Abilitare inserimento"}),"";var e=[];return e.push("play"),e.push("next"),e.push("insert"),this.setState({actionList:e,action:""}),""}},{key:"trigger",value:function(e){this.setState({action:e})}},{key:"render",value:function(){var e=this,t=this.props.posts.find((function(t){return t.id===Number(e.postId)})),n=this.state,a=n.selected,r=n.action;if(I.a.isNil(t))return i.a.createElement("div",null);var c=t.content.rendered.split("<p>");c=I.a.filter(c,(function(e){return!I.a.isEmpty(I.a.replace(e,/\n/,""))})),c=I.a.map(c,(function(e){return I.a.replace(e,"</p>","")}));var o=0;return c=I.a.map(c,(function(t){return o++,i.a.createElement("p",null,i.a.createElement(Ne,{selected:a,counter:o,handleSelect:e.handleSelect,data:t}))})),i.a.createElement(re.a,null,i.a.createElement(be.a,{className:"player-editor"},i.a.createElement(Ae.a,{onClick:function(){return e.trigger("play")}},"Play"),i.a.createElement(Ae.a,{onClick:function(){return e.trigger("next")}},"Next"),i.a.createElement(Ae.a,{onClick:function(){return e.trigger("prev")}},"Prev"),i.a.createElement(Ae.a,{onClick:function(){return e.refresh()}},"Reset audio"),i.a.createElement(Ae.a,{color:this.state.canAttach?"green":"red",onClick:function(){return e.setState({canAttach:!e.state.canAttach})}},"Inserimento - ",this.state.canAttach?"Attivo":"Disattivo"),i.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},"All audio files",i.a.createElement(je.a,{onChange:function(){e.setState({allAudio:!e.state.allAudio}),e.refresh()}}))),i.a.createElement(re.a.Item,{className:"text-container",componentClass:ie.a,xs:24,sm:24,lg:20,xl:22},i.a.createElement(be.a,null,c)),i.a.createElement(re.a.Item,{className:"fixed",componentClass:ie.a,xs:24,sm:24,lg:4,xl:2},i.a.createElement(Ce,{postId:this.postId,action:this.selectionChanged()?this.insertNextNplay():r,selected:this.state.selected,handleSelect:this.handleSelectAudio})))}}]),n}(i.a.Component),xe=Object(c.connect)((function(e){return{posts:b(e.posts)}}),(function(e){return Object.assign({},{dispatch:e})}))(Ue),Pe=n(400),De=n(193),Le=n(191),Fe=n(386),Me=n(399),Be=(n(371),function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){var a;return Object(J.a)(this,n),(a=t.call(this,e)).state={},a}return Object($.a)(n,[{key:"close",value:function(){this.props.close()}},{key:"componentDidUpdate",value:function(e,t){if(!1===e.show&&this.props.show&&""!==this.props.word){var n=this.props,a=n.word,r=n.dispatch;!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){t({type:"REQUEST_MEANING"}),fetch(y.API_DICTIONARY_URL+"meaning?word="+e.word||"",{header:{Autorization:"Bearer "+y.token}}).then((function(e){return e.json()})).then((function(e){return t(M(e))})).catch((function(e){return t(M({}))}))}}({word:a})(r),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){t({type:"REQUEST_TRADUCTION"}),fetch(y.API_DICTIONARY_URL+"traduction?word="+e.word||"",{header:{Autorization:"Bearer "+y.token}}).then((function(e){return e.json()})).then((function(e){return t(B(e))})).catch((function(e){return t(B({}))}))}}({word:a})(r)}}},{key:"render",value:function(){var e=this.props,t=e.meaning,n=e.traduction;return i.a.createElement(Fe.a,{show:this.props.show,onHide:this.close.bind(this)},i.a.createElement(Fe.a.Header,null,i.a.createElement(Fe.a.Title,null,i.a.createElement("b",null,'Word: "',this.props.word,'"'))),i.a.createElement(Fe.a.Body,null,this.props.fetchingMeaning?i.a.createElement(Me.a,{size:"md",content:"Loading definitions and sounds"}):i.a.createElement("div",null,i.a.createElement(me.a,null,i.a.createElement("b",null,"Definitions list")),i.a.createElement(Ve,{def:t.def}),i.a.createElement(me.a,null,i.a.createElement("b",null,"Sounds")),i.a.createElement(Ke,{lang:"English",src:t.uk}),i.a.createElement(Ke,{lang:"United States",src:t.us})),this.props.fetchingTraduction?i.a.createElement(Me.a,{size:"md",content:"Loading Traduction"}):i.a.createElement("div",null,i.a.createElement(me.a,null,i.a.createElement("b",null,"Traduction")),i.a.createElement(Se.a,{hover:!0,id:"traductions"},I.a.map(n,(function(e,t){return i.a.createElement(Se.a.Item,null,t+1,". ",e)}))))),"}",i.a.createElement(Fe.a.Footer,null))}}]),n}(r.Component));function Ve(e){var t=[],n=1;return I.a.forEach(e.def,(function(e,a){return t.push(i.a.createElement(Se.a.Item,{key:a},n+++". "+e.replace(":",""),"."))})),i.a.createElement(Se.a,{id:"definitions-list",hover:!0},t)}function Ke(e){return I.a.isEmpty(e.src)?null:i.a.createElement("div",null,e.lang,i.a.createElement("audio",{controls:!0,style:{width:"100%"}},i.a.createElement("source",{src:e.src,type:"audio/mpeg"})))}var Qe=Object(c.connect)((function(e){return{meaning:V(e.dictionary),fetchingMeaning:Q(e.dictionary),fetchingTraduction:z(e.dictionary),traduction:K(e.dictionary)}}),(function(e){return Object.assign({},{dispatch:e})}))(Be),ze=n(126),He=(n(377),function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){return Object(J.a)(this,n),t.call(this,e)}return Object($.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.data,a=t.counter,r=0;return I.a.map(n.split(" "),(function(t){r++;var n=a+"-"+r;return i.a.createElement("span",{key:r,id:n,onClick:e.props.handleSelect,className:"piece",dangerouslySetInnerHTML:{__html:"&nbsp;"+t}})}))}}]),n}(i.a.Component)),Ge=function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){var a;Object(J.a)(this,n),a=t.call(this,e);var r=e.match.params.postIta,i=e.match.params.postEng;return a.state={selected:"",selectedReference:"",selectedPiece:"",audioSelected:0,action:"",play:!1,isPlaying:!1,postEng:i,postIta:r,wordSelected:"",showTraduction:!1,playOnClick:!0},a.oldSelected=a.state.selected,a.handleSelect=a.handleSelect.bind(Object(Z.a)(a)),a.play=a.play.bind(Object(Z.a)(a)),a.playAll=a.playAll.bind(Object(Z.a)(a)),a.playIndex=0,a.hideTraduction=a.hideTraduction.bind(Object(Z.a)(a)),a.fetchData(),a}return Object($.a)(n,[{key:"fetchData",value:function(){var e=this.props.dispatch,t=this.state,n=t.postIta,a=t.postEng;k({postId:a})(e),k({postId:n})(e),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){return t({type:"REQUEST_REFERENCES"}),fetch(y.API_AUDIO_URL+"references?post_id="+(e.postId||""),{headers:{Authorization:"Bearer "+y.token}}).then((function(e){return e.json()})).then((function(e){return t(T(e))})).catch((function(e){return t(T([]))}))}}({postId:a})(e)}},{key:"componentDidMount",value:function(){I.a.delay((function(){window.scroll({top:0,left:0,behavior:"smooth"})}),1e3)}},{key:"getSelectionId",value:function(e){var t=e.split("-");return"".concat(t[1],"-").concat(t[2])}},{key:"insertReferencesIntoText",value:function(e){var t=this;I.a.isUndefined(this.referencesInserted)&&(this.referencesInserted=!0,I.a.forEach(e,(function(e){var n=t.getSelectionId(e.reference);document.getElementById(n).classList.add("selectable")})),_e.a.info({title:"References inserted"}))}},{key:"alignText",value:function(){if(I.a.isUndefined(this.textAligned)){this.textAligned=!0;var e=document.querySelectorAll("#ita p");I.a.forEach(document.querySelectorAll("#eng p"),(function(t,n){I.a.isUndefined(e[n])||(e[n].style.position="absolute",e[n].style.top=t.offsetTop+"px")})),_e.a.info({title:"Text ready!"})}}},{key:"getReferences",value:function(){var e=this.props.referencesList;return I.a.sortBy(e[this.state.postEng],["name"])}},{key:"componentDidUpdate",value:function(e,t){var n=this.getReferences();I.a.isEmpty(n)||(I.a.delay(this.insertReferencesIntoText.bind(this),1500,n),I.a.delay(this.alignText.bind(this),1500)),this.state.play&&(this.play(),this.setState({play:!1}))}},{key:"updateSelection",value:function(e){""!==this.state.selected&&document.getElementById(this.state.selected).classList.remove("selected"),e.classList.add("selected")}},{key:"onlyWord",value:function(e){return(e=e.replace(/&nbsp;/g,"")).replace(/[".,\/#!?$%\^&\*;:{}=\-_`~()\u201c\u201d]/g,"")}},{key:"handleSelect",value:function(e){var t=e.currentTarget;if(this.selectedPiece=t.id,t.classList.contains("selectable")){this.updateSelection(t);var n="".concat(this.state.postEng,"-").concat(t.id);this.setState({selected:t.id,selectedReference:n}),this.state.playOnClick&&this.setState({play:!0})}var a=this.onlyWord(t.innerHTML);this.state.playOnClick||_e.a.info({title:"Word selected for dictionary",description:a}),this.setState({wordSelected:a})}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.state,a=(n.selected,n.selectedReference),r=this.getReferences();if(I.a.isEmpty(a))_e.a.info({placement:"topStart",title:"Need selection first"});else{var i=null;if(0===e)i=I.a.find(r,(function(e){return e.reference===a}));else{this.playIndex=e,i=r[e];var c=this.getSelectionId(i.reference);this.updateSelection(document.getElementById(c)),this.setState({selectedReference:i.reference,selected:c})}var o=new Le.Howl({src:i.source,autoplay:!0,preload:!0});o.on("end",t)}}},{key:"playAll",value:function(){var e=this;this.setState({stopPlay:!1});var t=0;this.play(0,function n(){var a=e.state,r=a.selectedReference,i=a.stopPlay,c=e.getReferences();if(!i){for(0===t&&(t=I.a.findIndex(c,(function(e){return e.reference===r})));!I.a.isUndefined(c[t+1])&&c[t+1].name==c[t].name&&(++t,!I.a.isUndefined(c[t+1])););I.a.isUndefined(c[t+1])?_e.a.info({title:"End of Chapter"}):e.play(++t,n)}}.bind(this))}},{key:"trigger",value:function(e){var t=this;this.setState({action:e}),setTimeout((function(){return t.setState({action:""})}),100)}},{key:"hideTraduction",value:function(){this.setState({showTraduction:!1})}},{key:"render",value:function(){var e=this,t=this.props.posts.find((function(t){return t.id===Number(e.state.postEng)})),n=this.props.posts.find((function(t){return t.id===Number(e.state.postIta)})),a=this.state,r=a.selected,c=(a.action,a.playOnClick),o=a.wordSelected,s=a.showTraduction;if(I.a.isNil(t)||I.a.isNil(n))return i.a.createElement("div",null);var l=t.content.rendered.split("<p>");l=I.a.filter(l,(function(e){return!I.a.isEmpty(I.a.replace(e,/\n/,""))})),l=I.a.map(l,(function(e){return I.a.replace(e,"</p>","")}));var u=0;l=I.a.map(l,(function(t){return u++,i.a.createElement("p",{key:u},i.a.createElement(He,{selected:r,counter:u,handleSelect:e.handleSelect,data:t}))}));var d=n.content.rendered;return i.a.createElement(ze.StickyContainer,null,i.a.createElement(re.a,null,i.a.createElement(re.a.Item,{componentClass:ie.a,xs:24,sm:24,lg:24,xl:24},i.a.createElement(ze.Sticky,null,(function(t){var n=t.style;return i.a.createElement(be.a,{className:"player",style:n},i.a.createElement(Pe.a,{style:{display:"flex",alignItems:"center"}},i.a.createElement(De.a,{disabled:!!c,color:"blue",onClick:function(){return e.play()},icon:i.a.createElement(pe.a,{icon:"arrow-right"})},"Play"),i.a.createElement(je.a,{size:"lg",checkedChildren:"Play on click",unCheckedChildren:"Select word",checked:c,onChange:function(t){return e.setState({playOnClick:t})}}),i.a.createElement(me.a,{vertical:!0}),i.a.createElement(Ae.a,{color:"blue",onClick:e.playAll},"Play All"),i.a.createElement(Ae.a,{color:"violet",onClick:function(){return e.setState({stopPlay:!0})}},"Stop"),i.a.createElement(me.a,{vertical:!0}),i.a.createElement(Ae.a,{color:"green",onClick:function(){return e.setState({showTraduction:!0})}},"Dictionary ",o?'for "'.concat(o,'"'):null)))}))),i.a.createElement(re.a.Item,{id:"eng",className:"text-container eng",componentClass:ie.a,xs:12,sm:12,lg:12,xl:12},i.a.createElement("h2",{dangerouslySetInnerHTML:{__html:t.title.rendered}}),i.a.createElement(be.a,null,l)),i.a.createElement(re.a.Item,{id:"ita",className:"text-container ita",componentClass:ie.a,xs:12,sm:12,lg:12,xl:12},i.a.createElement("h2",{dangerouslySetInnerHTML:{__html:n.title.rendered}}),i.a.createElement(be.a,null,i.a.createElement("div",{dangerouslySetInnerHTML:{__html:d}}))),i.a.createElement(Qe,{word:o,show:s,close:this.hideTraduction})))}}]),n}(i.a.Component),We=(i.a.Component,Object(c.connect)((function(e){return{posts:_(e.reader),referencesList:A(e.reader),fetching:j(e.reader)}}),(function(e){return Object.assign({},{dispatch:e})}))(Ge));le.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(c.Provider,{store:q},i.a.createElement(o.a,null,i.a.createElement(Ie,null,i.a.createElement(s.c,null,i.a.createElement(s.a,{exact:!0,path:"/",component:ke}),i.a.createElement(s.a,{path:"/login",component:function(){}}),i.a.createElement(s.a,{path:"/editor/:post",component:xe}),i.a.createElement(s.a,{path:"/reader/:postEng/:postIta",render:function(e){return i.a.createElement(We,Object.assign({},e,{key:Date.now()}))}})))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[194,1,2]]]);
//# sourceMappingURL=main.898f4607.chunk.js.map